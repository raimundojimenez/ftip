
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>18/11/2020 &#8212; Fundamental Tools for Image Processing</title>
    
  <link rel="stylesheet" href="../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/sphinx-book-theme.2d2078699c18a0efb88233928e1cf6ed.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jbvinc.css" />
    <link rel="stylesheet" type="text/css" href="../_static/.ipynb_checkpoints/jbvinc-checkpoint.css" />
    <link rel="stylesheet" type="text/css" href="../_static/spanels-index--0afa1ebdab0bb23b98b56d34c23d9f57.css" />
    <link rel="stylesheet" type="text/css" href="../_static/spanels-variables--ffc7f74dcb1b9eecba2dbcbc22818714.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.be0a4a0c39cd630af62a2fcf693f3f06.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="25/10/2020" href="tp6-code.html" />
    <link rel="prev" title="04/11/2020" href="tp4-code.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  
  <h1 class="site-logo" id="site-title">Fundamental Tools for Image Processing</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../preface.html">
   Preface
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Basics
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../definition.html">
   What is a Digital Image?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../operations.html">
   Arithmetic Operations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../histogram.html">
   Histogram
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../convolution.html">
   Convolution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../fourier.html">
   Fourier Transform
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Compression
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../compression.html">
   Compression
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Mathematical Morphology
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../mm.html">
   Mathematical Morphology
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Registration
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../interpolation.html">
   Interpolation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../registration.html">
   Registration
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Segmentation
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../segmentation.html">
   Segmentation
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Restoration
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../denoising.html">
   Denoising
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../deconvolution.html">
   Deconvolution
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Feature Detection
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../feature/intro.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../feature/edges.html">
   Edges detection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../feature/corners.html">
   Corner detection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../feature/lines.html">
   Line detection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../feature/outro.html">
   Conclusion
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  In-Class Sessions
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../tp1.html">
   07/10/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tp2.html">
   14/10/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tp3.html">
   21/10/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tp4.html">
   04/11/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tp5.html">
   18/11/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tp6.html">
   25/11/2020
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Corrections
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="tp1-code.html">
   07/10/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tp2-code.html">
   14/10/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tp3-code.html">
   21/10/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tp4-code.html">
   04/11/2020
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   18/11/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tp6-code.html">
   25/10/2020
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Appendices
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference external" href="https://moodle3.unistra.fr/course/view.php?id=13708">
   Moodle
   <i class="fas fa-external-link-alt">
   </i>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python.html">
   Installing and Using Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../glossary.html">
   Glossary
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../biblio.html">
   References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../license.html">
   License
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/labs/tp5-code.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/vincmazet/ftip/blob/master/labs/tp5-code.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#debruitage">
   Débruitage
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#image-originale-et-image-bruitee">
     Image originale et image bruitée
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#filtre-moyenneur">
     Filtre moyenneur
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#debruitage-tv">
     Débruitage TV
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#comparaison-des-deux-methodes-de-debruitage-pour-differents-rsb">
     Comparaison des deux méthodes de débruitage pour différents RSB
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deconvolution">
   Déconvolution
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#images-originale-et-floutee">
     Images originale et floutée
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#filtre-inverse-sur-l-image-sans-bruit">
     Filtre inverse sur l’image sans bruit
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#filtre-inverse-avec-bruit">
     Filtre inverse avec bruit
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#filtre-de-wiener-avec-bruit">
     Filtre de Wiener avec bruit
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="id1">
<h1>18/11/2020<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="debruitage">
<h2>Débruitage<a class="headerlink" href="#debruitage" title="Permalink to this headline">¶</a></h2>
<p>Les objectifs de cet exercice sont :</p>
<ul class="simple">
<li><p>appliquer un bruit blanc gaussien au bon RSB sur une image</p></li>
<li><p>implémenter et régler un filtre moyenneur</p></li>
<li><p>implémenter un débruitage par régularisation TV et régler le paramètre de régularisation</p></li>
</ul>
<p>Deux méthodes de débruitage sont étudiées dans cette correction : le filtre moyenneur et la régularisation TV.</p>
<div class="cell tag_remove-input docutils container">
</div>
<p>Comme il y aura souvent besoin de calculer une EQM, je crée une fonction pour cela :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Erreur quadratique moyenne (MSE = mean square error)</span>
<span class="k">def</span> <span class="nf">mse</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="n">M</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">return</span> <span class="n">norm</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">M</span><span class="o">*</span><span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="section" id="image-originale-et-image-bruitee">
<h3>Image originale et image bruitée<a class="headerlink" href="#image-originale-et-image-bruitee" title="Permalink to this headline">¶</a></h3>
<p>L’image originale, en niveau de gris :</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/tp5-code_9_0.png" src="../_images/tp5-code_9_0.png" />
</div>
</div>
<p>Le rapport signal-à-bruit RSB est défini comme la puissance de l’image <span class="math notranslate nohighlight">\(x\)</span> divisée par la puissance du bruit <span class="math notranslate nohighlight">\(b\)</span>. On choisit généralement une échelle logarithmique :</p>
<div class="math notranslate nohighlight">
\[
\mathrm{RSB} = 10 \log_{10} \left(\frac{P_x}{P_b}\right)
\quad\Leftrightarrow\quad
10^\frac{\mathrm{RSB}}{10} = \frac{P_x}{P_b}
\]</div>
<p>avec :</p>
<div class="math notranslate nohighlight">
\[
Px = \frac{1}{MN} \sum_{m,n} x(m,n)^2
\quad\text{et}\quad
Pb = \frac{1}{MN} \sum_{m,n} b(m,n)^2 = \sigma^2
\]</div>
<p>Ainsi, d’après la première équation :</p>
<div class="math notranslate nohighlight">
\[\begin{split}
                     &amp;P_b = \frac{P_x}{10^\frac{\mathrm{RSB}}{10}} \\
\Leftrightarrow\quad &amp;\sigma^2 = P_x \times 10^{-\frac{\mathrm{RSB}}{10}} \\
\Leftrightarrow\quad &amp;\sigma^2 = \frac{1}{MN} \sum_{m,n} x(m,n)^2 10^{-\frac{\mathrm{RSB}}{10}} \\
\end{split}\]</div>
<p>Remarquez que <span class="math notranslate nohighlight">\(\sqrt{\sum_{m,n}x(m,n)^2}\)</span> correspond à la norme de Frobenius de <span class="math notranslate nohighlight">\(x\)</span>, qui peut être calculée avec <code class="docutils literal notranslate"><span class="pre">numpy.linalg.norm</span></code>.</p>
<p>Les figures ci-dessous représentent l’image à différents niveaux de bruit.</p>
<p><strong>Attention :</strong> spécifiez <code class="docutils literal notranslate"><span class="pre">clip=False</span></code> dans l’utilisation de <code class="docutils literal notranslate"><span class="pre">skimage.util.random_noise</span></code>, afin d’ajouter un bruit réellement gaussien !</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/tp5-code_13_0.png" src="../_images/tp5-code_13_0.png" />
</div>
</div>
<p>On remarque bien que plus le RSB est grand, moins le bruit est visible. Cela est logique puisque, dans la définition du RSB, la puissance du bruit apparaît au dénominateur. Par ailleurs, à partir de 30 dB, le bruit devient quasiment invisible, alors qu’en dessous de 0 dB, il est très fort et l’image n’est quasiment plus visible.</p>
</div>
<div class="section" id="filtre-moyenneur">
<h3>Filtre moyenneur<a class="headerlink" href="#filtre-moyenneur" title="Permalink to this headline">¶</a></h3>
<p>Je choisis de débruiter l’image avec un RSB égal à 10 dB, et j’applique un filtre moyenneur.</p>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/tp5-code_18_0.png" src="../_images/tp5-code_18_0.png" />
</div>
</div>
<p>On observe que le moyennage a permis de diminuer le bruit, ce qui était attendu (avez-vous essayé pour un filtre de taille 1 ? Que se passe-t-il ?). Par contre, l’image est plus floue : les contours sont moins nets. Cette seconde observation s’explique puisque le filtre moyenneur correspond à une convolution par un noyau qui n’est pas impulsionnel : il y a donc un étalement des intensités des pixels les uns sur les autres.</p>
<p>Une mesure quantitative permettant de mesurer la qualité du débruitage est de calculer l’EQM entre l’image débruitée <span class="math notranslate nohighlight">\(\hat{x}\)</span> et <span class="math notranslate nohighlight">\(x\)</span>. Ainsi, le débruitage permettra d’améliorer l’EQM, mais dans le même temps le flou introduit va dégrader l’EQM. En conséquence, on peut s’attendre à ce que l’EQM évolue en fonction de la taille <code class="docutils literal notranslate"><span class="pre">w</span></code> du filtre. Pour vérifier cette hypothèse, on peut tracer les valeurs que prend l’EQM pour différentes valeurs de <code class="docutils literal notranslate"><span class="pre">w</span></code> :</p>
<div class="cell tag_remove-input tag_hide docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>La meilleure restauration est obtenue pour w = 5 et correspond à une EQM = 2.180881e-03
</pre></div>
</div>
<img alt="../_images/tp5-code_20_1.png" src="../_images/tp5-code_20_1.png" />
</div>
</div>
<p>Comme nous pouvions nous y attendre, l’EQM évolue bien en fonction de la taille du filtre moyenneur. Il faut donc faire un compromis entre la capacité de débruitage et le flou introduit par le filtre. On observe quand même que la courbe présente un minimum : cela correspond à l’EQM la plus faible qui est obtenue, ici pour <code class="docutils literal notranslate"><span class="pre">w</span></code>=5.</p>
<p>Malheureusement, il n’y a pas de moyen simple de connaître a priori la meilleur taille du filtre moyenneur à partir du RSB. La valeur obtenue ici dépend également de l’image (essayez avec une autre image !).</p>
</div>
<div class="section" id="debruitage-tv">
<h3>Débruitage TV<a class="headerlink" href="#debruitage-tv" title="Permalink to this headline">¶</a></h3>
<p>Sur l’image bruitée à RSB = 10 dB, on effectue maintenant un débruitage par régularisation TV (<em>total variation</em>).</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/tp5-code_24_0.png" src="../_images/tp5-code_24_0.png" />
</div>
</div>
<p>Comme avec le filtre moyenneur, on observe que l’image est bien débruitée (le bruit est plus faible, donc l’EQM sera meilleure), mais que certains détails de l’image, comme les yeux, sont modifiés, ce qui aura pour conséquence de dégrader l’EQM. On peut donc s’attendre, comme précédemment, à ce qu’il existe une valeur optimale du paramètre de régularisation <span class="math notranslate nohighlight">\(\lambda\)</span>. Reste à savoir si cette technique de débruitage pourra dépasser les performances du filtre moyenneur…</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>La meilleure restauration est obtenue pour lambda = 0.16 et correspond à une EQM = 1.573617e-03
</pre></div>
</div>
<img alt="../_images/tp5-code_26_1.png" src="../_images/tp5-code_26_1.png" />
</div>
</div>
<p>La courbe a le même type de comportement que dans le cas du filtre moyenneur : il existe une valeur optimale du paramètre de la méthode pour laquelle l’EQM est meilleure. Ici, on a <span class="math notranslate nohighlight">\(\lambda=0,16\)</span>.</p>
<p>À y regarder de plus près, on remarque que la meilleure EQM a une valeur plus faible que la meilleur EQM obtenue dans le cas du filtre moyenneur. Conclusion : le débruitage par régularisation TV est plus performant que le filtre moyenneur !
Mais attention : cette conclusion est partielle, car obtenue seulement pour l’image lena.tiff avec un RSB de 10 dB.</p>
</div>
<div class="section" id="comparaison-des-deux-methodes-de-debruitage-pour-differents-rsb">
<h3>Comparaison des deux méthodes de débruitage pour différents RSB<a class="headerlink" href="#comparaison-des-deux-methodes-de-debruitage-pour-differents-rsb" title="Permalink to this headline">¶</a></h3>
<p>En calculant, pour plusieurs valeurs de RSB, les meilleurs paramètres pour les deux méthodes, on peut analyser l’évolution de l’EQM en fonction du niveau de bruit de l’image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rsbs</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># Filtre moyenneur</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">40</span><span class="p">)</span>
<span class="n">mean_eqm</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">rsbs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">mean_w</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">rsbs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Régularisation TV</span>
<span class="n">lbds</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
<span class="n">tv_eqm</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">rsbs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">tv_lbd</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">rsbs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rsb</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rsbs</span><span class="p">):</span>
    
    <span class="c1"># Génération de l&#39;image bruitée</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">stddev</span><span class="p">(</span><span class="n">rsb</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">random_noise</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;gaussian&#39;</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Filtre moyenneur</span>
    <span class="n">besteqm</span> <span class="o">=</span> <span class="n">inf</span>
    <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">ws</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">ones</span><span class="p">((</span><span class="n">w</span><span class="p">,</span><span class="n">w</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">w</span><span class="o">*</span><span class="n">w</span><span class="p">)</span>
        <span class="n">xest</span> <span class="o">=</span> <span class="n">convolve</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
        <span class="n">eqm</span> <span class="o">=</span> <span class="n">mse</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xest</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">eqm</span> <span class="o">&lt;</span> <span class="n">besteqm</span><span class="p">:</span>
            <span class="n">besteqm</span> <span class="o">=</span> <span class="n">eqm</span>
            <span class="n">bestw</span> <span class="o">=</span> <span class="n">w</span>
    <span class="n">mean_eqm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">besteqm</span>
    <span class="n">mean_w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bestw</span>
    
    <span class="c1"># Débruitage TV</span>
    <span class="n">besteqm</span> <span class="o">=</span> <span class="n">inf</span>
    <span class="k">for</span> <span class="n">lbd</span> <span class="ow">in</span> <span class="n">lbds</span><span class="p">:</span>
        <span class="n">xest</span> <span class="o">=</span> <span class="n">denoise_tv_chambolle</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">lbd</span><span class="p">)</span>
        <span class="n">eqm</span> <span class="o">=</span> <span class="n">mse</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xest</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">eqm</span> <span class="o">&lt;</span> <span class="n">besteqm</span><span class="p">:</span>
            <span class="n">besteqm</span> <span class="o">=</span> <span class="n">eqm</span>
            <span class="n">bestlbd</span> <span class="o">=</span> <span class="n">lbd</span>
    <span class="n">tv_eqm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">besteqm</span>
    <span class="n">tv_lbd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bestlbd</span>
</pre></div>
</div>
</div>
</div>
<p>On peut alors représenter l’évolution de l’EQM pour les deux méthodes :</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/tp5-code_32_0.png" src="../_images/tp5-code_32_0.png" />
</div>
</div>
<p>On observe une décroissance de l’EQM en fonction du RSB. Cela s’interprète par le fait lorsque le bruit diminue, l’image débruitée ressemble de plus en plus à la vérité terrain, ce qui est tout à fait logique.</p>
<p>Par ailleurs, on observe que :</p>
<ul class="simple">
<li><p>pour des RSB inférieurs à (environ) 0 dB, le filtre moyenneur est meilleur que la régularisation TV. Cela peut paraître surprenant puisque la régularisation TV est censée être meilleure, c’est d’ailleurs ce qu’on a pu vérifier ci-avant. Cependant, un RSB inférieur à 0 dB est extrêmement faible. En fait, aucune des deux méthodes ne donne un résultat réellement satisfaisant (voir ci-après)</p></li>
<li><p>pour des images à RSB supérieurs à 0 dB, la régularisation TV est meilleure.</p></li>
</ul>
<p>Observons maintenant l’évolution des valeurs des meilleurs paramètres des deux méthodes, en fonction du RSB :</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/tp5-code_35_0.png" src="../_images/tp5-code_35_0.png" />
</div>
</div>
<p>Pour les deux méthodes, la valeur du paramètre décroît lorsque le RSB augmente.</p>
<ul class="simple">
<li><p>pour le filtre moyenneur (en bleu), la fenêtre utilisée est donc de plus en plus petite lorsque le bruit diminue. C’est logique : le bruit diminuant, il n’est pas nécessaire de moyenner sur un grand voisinage, ce qui permet de trop flouter l’image.</p></li>
<li><p>pour la régularisation TV (rouge), le paramètre de régularisation est plus faible lorsque le bruit diminue. C’est également logique : en diminuant, le paramètre de régularisation donne moins de poids à la régularisation qui est là surtout pour compenser le bruit. S’il y a moins de bruit, il y a moins besoin de régulariser !</p></li>
</ul>
<p>On peut vérifier que ces conclusions sont en accord avec ce qu’on peut observer sur quelques exemples :</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/tp5-code_37_0.png" src="../_images/tp5-code_37_0.png" />
<img alt="../_images/tp5-code_37_1.png" src="../_images/tp5-code_37_1.png" />
<img alt="../_images/tp5-code_37_2.png" src="../_images/tp5-code_37_2.png" />
</div>
</div>
<p>OK, on retrouve les mêmes conclusions que précédemment.</p>
<p>La comparaison entre ces deux méthodes n’a été effectuée que sur une seule image et un seul critère (la qualité du résultat en termes d’EQM). C’est sans doute le meilleur critère pour comparer deux méthodes, mais d’autres points de comparaison existent, comme par exemple la complexité de la méthode, le temps de calcul, etc.</p>
</div>
</div>
<div class="section" id="deconvolution">
<h2>Déconvolution<a class="headerlink" href="#deconvolution" title="Permalink to this headline">¶</a></h2>
<p>Les objectifs de cet exercice sont :</p>
<ul class="simple">
<li><p>savoir appliquer une dégradation connue sur une image</p></li>
<li><p>comprendre pourquoi la déconvolution naïve ne fonctionne pas</p></li>
<li><p>implémenter un filtre de Wiener</p></li>
</ul>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
</div>
<div class="section" id="images-originale-et-floutee">
<h3>Images originale et floutée<a class="headerlink" href="#images-originale-et-floutee" title="Permalink to this headline">¶</a></h3>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/tp5-code_46_0.png" src="../_images/tp5-code_46_0.png" />
</div>
</div>
<p>La mire « USAF 1951 » est un outil pour mesurer la résolution d’instruments optiques. Elle a été conçu par l’U.S. Air Force. Son intérêt en traitement d’images est de mesurer la capacité de résolution des méthodes. Ici, elle est intéressante car une fois floutée, il est difficile de comptabiliser les lignes et de lire les chiffres.</p>
</div>
<div class="section" id="filtre-inverse-sur-l-image-sans-bruit">
<h3>Filtre inverse sur l’image sans bruit<a class="headerlink" href="#filtre-inverse-sur-l-image-sans-bruit" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Notez qu&#39;il n&#39;est pas nécessaire ici d&#39;utiliser fftshift.</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">fft2</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">fft2</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>     <span class="c1"># Attention, pour pouvoir diviser les deux FFT, elles doivent être de la même taille !</span>
<span class="n">Xest</span> <span class="o">=</span> <span class="n">Y</span><span class="o">/</span><span class="n">H</span>
<span class="n">xest</span> <span class="o">=</span> <span class="n">real</span><span class="p">(</span><span class="n">ifft2</span><span class="p">(</span><span class="n">Xest</span><span class="p">))</span> <span class="c1"># Attention, bien prendre la partie réelle !</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/tp5-code_50_0.png" src="../_images/tp5-code_50_0.png" />
</div>
</div>
<p>En l’absence de bruit, le filtre inverse fonctionne parfaitement (à l’exception d’un décalage).</p>
</div>
<div class="section" id="filtre-inverse-avec-bruit">
<h3>Filtre inverse avec bruit<a class="headerlink" href="#filtre-inverse-avec-bruit" title="Permalink to this headline">¶</a></h3>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/tp5-code_53_0.png" src="../_images/tp5-code_53_0.png" />
</div>
</div>
<p>En revanche, lorsque l’image est bruitée (même faiblement : ici le RSB est de 40 dB), la restauration n’est pas du tout acceptable !</p>
</div>
<div class="section" id="filtre-de-wiener-avec-bruit">
<h3>Filtre de Wiener avec bruit<a class="headerlink" href="#filtre-de-wiener-avec-bruit" title="Permalink to this headline">¶</a></h3>
<p>Attention, il existe une autre fonction <code class="docutils literal notranslate"><span class="pre">wiener</span></code> (<code class="docutils literal notranslate"><span class="pre">skimage.filters.wiener</span></code>), mais elle est plus délicate à utiliser. Utilisez plutôt <code class="docutils literal notranslate"><span class="pre">skimage.restoration.wiener</span></code>, en n’oubliant pas l’argument <code class="docutils literal notranslate"><span class="pre">clip=False</span></code>.</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/tp5-code_57_0.png" src="../_images/tp5-code_57_0.png" />
<img alt="../_images/tp5-code_57_1.png" src="../_images/tp5-code_57_1.png" />
</div>
</div>
<p>Ces premiers résultats, pour trois valeurs du paramètre <span class="math notranslate nohighlight">\(\lambda\)</span>, permettent de montrer qu’en termes d’EQM, il y a un compromis à faire entre la puissance du débruitage et la conservation de l’image originale. Si <span class="math notranslate nohighlight">\(\lambda\)</span> est trop faible, l’image restaurée est bien déconvoluée mais reste très bruitée ; si <span class="math notranslate nohighlight">\(\lambda\)</span> est trop grand alors l’image reste floue.</p>
<p>Pour une meilleure analyse, nous alons représenter l’évolution de l’EQM en fonction de <span class="math notranslate nohighlight">\(\lambda\)</span> (comme dans l’exercice 1).</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/tp5-code_59_0.png" src="../_images/tp5-code_59_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>La meilleure restauration est obtenue pour lambda = 90 et correspond à une EQM = 1031.34.
</pre></div>
</div>
<img alt="../_images/tp5-code_59_2.png" src="../_images/tp5-code_59_2.png" />
</div>
</div>
<p>Personnellement, je trouve que cette valeur de <span class="math notranslate nohighlight">\(\lambda\)</span> fournit une image moins claire que pour des valeurs de <span class="math notranslate nohighlight">\(\lambda\)</span> plus faibles (comme celles présentées plus haut). Cela montre que l’EQM ne représente pas parfaitement la qualité perçue. Mais contrairement à la qualité perçue qui peut être subjective ou dépendre de l’objectif souhaité, l’EQM est une mesure objective et quantitative.</p>
<p>Cela dit, la déconvolution a tout de même joué son rôle : les lignes et les chiffres sont lisibles, contrairement à l’image observée.</p>
<p>Enfin, et comme pour les méthodes de débruitage de l’exercice 1, il est très difficile de fixer a priori la valeur du paramètre <span class="math notranslate nohighlight">\(\lambda\)</span>.</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./labs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="tp4-code.html" title="previous page">04/11/2020</a>
    <a class='right-next' id="next-link" href="tp6-code.html" title="next page">25/10/2020</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Vincent Mazet (University of Strasbourg, France)<br/>
        
            &copy; Copyright 2020.<br/>
          <div class="extra_footer">
            Fundamental Tools for Image Processing &mdash; Vincent Mazet (Université de Strasbourg), 2020 &mdash; <a href="license.html">CC BY-NC 4.0</a>.
          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>