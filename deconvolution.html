
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Deconvolution &#8212; Fundamental Tools for Image Processing</title>
    
  <link rel="stylesheet" href="_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/sphinx-book-theme.2d2078699c18a0efb88233928e1cf6ed.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/jbvinc.css" />
    <link rel="stylesheet" type="text/css" href="_static/.ipynb_checkpoints/jbvinc-checkpoint.css" />
    <link rel="stylesheet" type="text/css" href="_static/spanels-index--0afa1ebdab0bb23b98b56d34c23d9f57.css" />
    <link rel="stylesheet" type="text/css" href="_static/spanels-variables--ffc7f74dcb1b9eecba2dbcbc22818714.css" />
    
  <link rel="preload" as="script" href="_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.be0a4a0c39cd630af62a2fcf693f3f06.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="(Pattern &amp; Co)" href="xxx_pattern.html" />
    <link rel="prev" title="Denoising" href="denoising.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  
  <h1 class="site-logo" id="site-title">Fundamental Tools for Image Processing</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="preface.html">
   Preface
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Courses
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="definition.html">
   What is a Digital Image?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="operations.html">
   Arithmetic Operations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="histogram.html">
   Histogram
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="convolution.html">
   Convolution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="fourier.html">
   Fourier Transform
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="compression.html">
   Compression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mm.html">
   Mathematical Morphology
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="interpolation.html">
   Interpolation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="registration.html">
   Registration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="segmentation.html">
   Segmentation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="denoising.html">
   Denoising
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Deconvolution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="xxx_pattern.html">
   (Pattern &amp; Co)
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  In-Class Sessions
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="tp1.html">
   07/10/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tp2.html">
   14/10/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tp3.html">
   21/10/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tp4.html">
   04/11/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tp5.html">
   18/11/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tp6.html">
   25/11/2020
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Corrections
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="labs/tp1-code.html">
   07/10/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="labs/tp2-code.html">
   14/10/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="labs/tp3-code.html">
   21/10/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="labs/tp4-code.html">
   04/11/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="labs/tp5-code.html">
   18/10/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="labs/tp6-code.html">
   25/10/2020
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Appendices
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference external" href="https://moodle3.unistra.fr/course/view.php?id=13708">
   Moodle
   <i class="fas fa-external-link-alt">
   </i>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="python.html">
   Installing and Using Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="glossary.html">
   Glossary
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="biblio.html">
   References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="license.html">
   License
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/deconvolution.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/vincmazet/ftip/blob/master/deconvolution.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#filtre-inverse">
   Filtre inverse
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#filtre-de-wiener">
   Filtre de Wiener
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   Conclusion
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="deconvolution">
<span id="c-deconvolution"></span><h1>Deconvolution<a class="headerlink" href="#deconvolution" title="Permalink to this headline">¶</a></h1>
<p>La déconvolution consiste à annuler l’effet de la convolution par un filtre.
Il est fréquent, en effet, que l’acquisition d’une image introduise une dégradation de celle-ci qui peut être modélisée par une convolution.
C’est le cas par exemple d’un effet de bougé (<a class="reference internal" href="#f-deconvolution-example-motion"><span class="std std-numref">Fig. 80</span></a>)
ou de flou dû à une mauvaise mise au point (<a class="reference internal" href="#f-deconvolution-example-blur"><span class="std std-numref">Fig. 81</span></a>).</p>
<div class="figure align-default" id="f-deconvolution-example-motion">
<a class="reference internal image-reference" href="_images/restauration9.png"><img alt="_images/restauration9.png" src="_images/restauration9.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-number">Fig. 80 </span><span class="caption-text">Flou de bougé et le résultat d’une déconvolution idéale.</span><a class="headerlink" href="#f-deconvolution-example-motion" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="f-deconvolution-example-blur">
<a class="reference internal image-reference" href="_images/restauration10.png"><img alt="_images/restauration10.png" src="_images/restauration10.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-number">Fig. 81 </span><span class="caption-text">Flou de mise au point et le résultat d’une déconvolution idéale.</span><a class="headerlink" href="#f-deconvolution-example-blur" title="Permalink to this image">¶</a></p>
</div>
<p>Le problème est donc modélisé comme dans la <a class="reference internal" href="#f-deconvolution-model"><span class="std std-numref">Fig. 82</span></a> :
l’image observée <span class="math notranslate nohighlight">\(y\)</span> est dégradée par la convolution avec une PSF <span class="math notranslate nohighlight">\(h\)</span> et, éventuellement, par un bruit <span class="math notranslate nohighlight">\(b\)</span> (que l’on considère additif).
Le modèle de la dégradation est donc :</p>
<div class="math notranslate nohighlight">
\[
y = h*x + b
\]</div>
<p>À partir de l’observation <span class="math notranslate nohighlight">\(y\)</span>, la déconvolution calcule une image déconvoluée <span class="math notranslate nohighlight">\(\widehat{x}\)</span>.
Dans le cadre du cours, nous ne considérons que les méthodes linéaires, qui reviennent donc à un filtrage par <span class="math notranslate nohighlight">\(g\)</span> :</p>
<div class="math notranslate nohighlight">
\[
\widehat{x} = g*y
\]</div>
<div class="figure align-default" id="f-deconvolution-model">
<a class="reference internal image-reference" href="_images/restauration11.png"><img alt="_images/restauration11.png" src="_images/restauration11.png" style="width: 400px;" /></a>
<p class="caption"><span class="caption-number">Fig. 82 </span><span class="caption-text">Modèle de la déconvolution</span><a class="headerlink" href="#f-deconvolution-model" title="Permalink to this image">¶</a></p>
</div>
<p>Pour effectuer au mieux la déconvolution, il faut donc un modèle de la dégradation
(donc connaître à la fois <span class="math notranslate nohighlight">\(h\)</span> et <span class="math notranslate nohighlight">\(b\)</span>).</p>
<p>La PSF <span class="math notranslate nohighlight">\(h\)</span> peut être estimée par observation, c’est-à-dire en trouvant dans l’image des indices permettant d’estimer <span class="math notranslate nohighlight">\(h\)</span>
(par exemple, un objet ponctuel isolé dans l’image deviendra réellement <span class="math notranslate nohighlight">\(h\)</span>).
Elle peut également être estimée par expérimentation, donc en reproduisant en laboratoire les conditions d’observation.
L’image d’une impulsion observée ainsi donne une estimation de <span class="math notranslate nohighlight">\(h\)</span>.
Enfin, il est possible d’estimer la PSF en modélisant mathématiquement la physique de l’observation.
Notons par ailleurs que certaines méthodes de déconvolution estiment la PSG <span class="math notranslate nohighlight">\(h\)</span> en même temps que <span class="math notranslate nohighlight">\(x\)</span> :
ce sont des méthodes de déconvolution myope (<em>blind deconvolution</em>).</p>
<!-- développer le 1er exemple, notamment avec une illustration en astro -->
<!-- 1er point : déconvolution naïve en l'absence de bruit dans une petite zone, essai--erreur, ..-->
<p>Les modèles de bruit ont déjà été présentés dans le chapitre <a class="reference internal" href="denoising.html#c-denoising"><span class="std std-ref">Denoising</span></a>.</p>
<div class="section" id="filtre-inverse">
<h2>Filtre inverse<a class="headerlink" href="#filtre-inverse" title="Permalink to this headline">¶</a></h2>
<p>Le filtre inverse est la méthode de déconvolution la plus simple.
Puisque la dégradation se modélise <span class="math notranslate nohighlight">\(y = h*x + b\)</span>, alors dans le domaine de Fourier cette équation devient :</p>
<div class="math notranslate nohighlight">
\[
Y = HX + B
\]</div>
<p>et on peut donc écrire :</p>
<div class="math notranslate nohighlight">
\[
X = \frac{Y-B}{H}.
\]</div>
<p>On obtient donc <span class="math notranslate nohighlight">\(x\)</span> en calculant la transformée de Fourier inverse de l’expression précédente :</p>
<div class="math notranslate nohighlight">
\[
x = \mathcal{F}^{-1} \left[ \frac{Y-B}{H} \right].
\]</div>
<p>Comme le bruit (et donc son spectre <span class="math notranslate nohighlight">\(B\)</span>) est inconnu, on peut approximer l’expression de <span class="math notranslate nohighlight">\(x\)</span> en annulant <span class="math notranslate nohighlight">\(B\)</span> dans l’expression précédente,
et donc obtenir l’image déconvoluée :</p>
<div class="math notranslate nohighlight">
\[
\widehat{x} = \mathcal{F}^{-1} \left[ \frac{Y}{H} \right]
\]</div>
<p>Le résultat du filtre inverse est donné <a class="reference internal" href="#f-deconvolution-inverse"><span class="std std-numref">Fig. 83</span></a>.
Le résultat n’est absolument pas exploitable, et pourtant l’image observée est très peu floutée et très peu bruitée !</p>
<div class="figure align-default" id="f-deconvolution-inverse">
<a class="reference internal image-reference" href="_images/restauration12.png"><img alt="_images/restauration12.png" src="_images/restauration12.png" style="width: 800px;" /></a>
<p class="caption"><span class="caption-number">Fig. 83 </span><span class="caption-text">Résultat du filtre inverse.
De gauche à droite : image originale <span class="math notranslate nohighlight">\(x\)</span>, image observée <span class="math notranslate nohighlight">\(y\)</span>, sortie du filtre inverse <span class="math notranslate nohighlight">\(\widehat{x}\)</span>,
sortie du filtre inverse tronqué <span class="math notranslate nohighlight">\(\widehat{x}\)</span> (10 % de la taille de l’image).</span><a class="headerlink" href="#f-deconvolution-inverse" title="Permalink to this image">¶</a></p>
</div>
<p>Le résultat catastrophique du filtre inverse est dû au fait d’avoir considéré le bruit nul.
En effet, d’après la définition de <span class="math notranslate nohighlight">\(\widehat{x}\)</span>, et puisque <span class="math notranslate nohighlight">\(Y=HX+B\)</span>, alors :</p>
<div class="math notranslate nohighlight">
\[
\widehat{x}
= \mathcal{F}^{-1} \left[ \frac{Y}{H} \right]
= \mathcal{F}^{-1} \left[ X + \frac{B}{H} \right]
= x + \mathcal{F}^{-1} \left[ \frac{B}{H} \right]
\]</div>
<p>Ainsi, l’image déconvoluée <span class="math notranslate nohighlight">\(\widehat{x}\)</span> correspond à <span class="math notranslate nohighlight">\(x\)</span> avec un terme parasite qui est la transformée de Fourier inverse de <span class="math notranslate nohighlight">\(B/H\)</span>.
Or, très souvent, la PSF <span class="math notranslate nohighlight">\(H\)</span> est un filtre passe-bas,
ce qui implique que les valeurs de <span class="math notranslate nohighlight">\(H(m,n)\)</span> tendent vers <span class="math notranslate nohighlight">\(0\)</span> lorsque les fréquences <span class="math notranslate nohighlight">\((m,n)\)</span> deviennent grandes.
<span class="math notranslate nohighlight">\(H\)</span> étant au dénominateur du terme parasite, elle a tendance à amplifier les hautes fréquences du bruit d’un facteur qui tend vers <span class="math notranslate nohighlight">\(+\infty\)</span>.
Finalement, le terme <span class="math notranslate nohighlight">\(B/H\)</span> peut rapidement dominer <span class="math notranslate nohighlight">\(X\)</span>.
Cela explique le résultat de la <a class="reference internal" href="#f-deconvolution-inverse"><span class="std std-numref">Fig. 83</span></a>.</p>
<p>Une solution consiste à calculer non pas la transformée de Fourier inverse de toute l’image <span class="math notranslate nohighlight">\(Y/H\)</span>,
mais seulement de ses basses fréquences.
Cela signifie que les hautes fréquences de <span class="math notranslate nohighlight">\(Y/H\)</span>, qui peuvent tendre vers l’infini comme on l’a dit,
sont annulées avant de calculer la transformée de Fourier inverse.
Autrement dit, le filtre inverse est tronqué à une partie du spectre.
Ainsi, le résultat de la déconvolution est beaucoup plus acceptable, comme le montre la <a class="reference internal" href="#f-deconvolution-inverse"><span class="std std-numref">Fig. 83</span></a>,
bien que le résultat soit encore loin d’être parfait
(il y a de nombreuses variations d’intensité autour des objets, comme les tronc des arbres)…</p>
</div>
<div class="section" id="filtre-de-wiener">
<h2>Filtre de Wiener<a class="headerlink" href="#filtre-de-wiener" title="Permalink to this headline">¶</a></h2>
<p>Le filtre de Wiener, noté <span class="math notranslate nohighlight">\(g\)</span> (et sa transformée de Fourier <span class="math notranslate nohighlight">\(G\)</span>), s’applique sur l’observation <span class="math notranslate nohighlight">\(y\)</span> :</p>
<div class="math notranslate nohighlight">
\[
y = g * y
\qquad\Leftrightarrow\qquad
Y = GY.
\]</div>
<p>Ce filtre est établi dans le cadre statistique : l’image <span class="math notranslate nohighlight">\(x\)</span> et le bruit <span class="math notranslate nohighlight">\(b\)</span> sont considérés comme étant des variables aléatoires.
Elles sont également supposées statistiquement indépendantes.
Il en résulte que l’observation <span class="math notranslate nohighlight">\(y\)</span> et l’estimation <span class="math notranslate nohighlight">\(\widehat{x}\)</span> sont également des variables aléatoires.</p>
<p>Les calculs sont effectués dans le domaine de Fourier, pour utiliser des multiplications plutôt que des convolutions.
L’objectif du filtre de Wiener est donc de trouver l’image <span class="math notranslate nohighlight">\(\widehat{X} = \mathcal{F}[\widehat{x}]\)</span> la plus proche de <span class="math notranslate nohighlight">\(X=\mathcal{F}[x]\)</span>,
au sens de l’erreur quadratique moyenne <span class="math notranslate nohighlight">\(\mathrm{EQM} = \mathbb{E}\left[(\widehat{X}-X)^2\right]\)</span>.
Ainsi :</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\mathrm{EQM}
&amp;= \mathbb{E}\left[(\widehat{X}-X)^2\right] \\
&amp;= \mathbb{E}\left[(GY-X)^2\right] \\
&amp;= \mathbb{E}\left[\big(G(HX+B)-X\big)^2\right] \\
&amp;= \mathbb{E}\left[\big((GH-I)X+GB\big)^2\right]
\end{split}\]</div>
<p>où <span class="math notranslate nohighlight">\(I\)</span> est une image remplie de 1.
En développant le carré (et en notant le conjugué des variables avec <span class="math notranslate nohighlight">\(\cdot^*\)</span>), on obtient :</p>
<div class="math notranslate nohighlight">
\[
\mathrm{EQM} = \mathbb{E}\Big[ (GH-I)^*(GH-I)X^*X + (GH-I)^*GX^*B + G^*(GH-I)B^*X + G^*GB^*B \Big].
\]</div>
<p>Comme l’espérance est linéaire et que seules <span class="math notranslate nohighlight">\(X\)</span> et <span class="math notranslate nohighlight">\(B\)</span> sont des variables aléatoires,
on peut décomposer l’expression précédente en quatre termes :</p>
<div class="math notranslate nohighlight">
\[
\mathrm{EQM}
= (GH-I)^*(GH-I) \mathbb{E}\big[X^*X\big]
+ (GH-I)^*G \mathbb{E}\big[X^*B\big]
+ G^*(GH-I) \mathbb{E}\big[B^*X\big]
+ G^*G \mathbb{E}\big[B^*B\big].
\]</div>
<p>Comme <span class="math notranslate nohighlight">\(X\)</span> et <span class="math notranslate nohighlight">\(B\)</span> sont indépendantes, alors leurs covariances <span class="math notranslate nohighlight">\(\mathbb{E}\big[X^*B\big]\)</span> et <span class="math notranslate nohighlight">\(\mathbb{E}\big[B^*X\big]\)</span> sont nulles.
Par ailleurs, <span class="math notranslate nohighlight">\(\mathbb{E}\big[X^*X\big]\)</span> et <span class="math notranslate nohighlight">\(\mathbb{E}\big[B^*B\big]\)</span> sont les densités spectrales de puissances notées <span class="math notranslate nohighlight">\(S_x\)</span> et <span class="math notranslate nohighlight">\(S_b\)</span>
(on rappelle que la densité spectrale de puissance est l’espérance du carré du module de la transformée de Fourier).
Donc l’erreur quadratique se simplifie en :</p>
<div class="math notranslate nohighlight">
\[
\mathrm{EQM} = (GH-1)^*(GH-1) S_x + G^*G S_b
\]</div>
<p>Il faut donc chercher le filtre <span class="math notranslate nohighlight">\(G\)</span> qui minimise l’EQM, ou demanière équivalente, qui annule la dérivée de l’EQM :</p>
<div class="math notranslate nohighlight">
\[\begin{split}
                       &amp; \frac{\partial \mathrm{EQM}}{\partial G} = (GH-1)^*H S_x + G^* S_b = 0 \\
  \Leftrightarrow\quad &amp;G^*H^*H S_x - H S_x + G^* S_b = 0  \\
  \Leftrightarrow\quad &amp;G^* ( H^*H S_x + S_b) = H S_x  \\
  \Leftrightarrow\quad &amp;G^* = \frac{H S_x}{H^*H S_x + S_b}  \\
  \Leftrightarrow\quad &amp;G = \frac{H^* S_x}{H^*H S_x + S_b}  \\
  \Leftrightarrow\quad &amp;G = \frac{H^* S_x}{|H|^2 S_x + S_b}
\end{split}\]</div>
<p>On a obtenu l’expression de <span class="math notranslate nohighlight">\(G\)</span> qui constitue le filtre de Wiener !
Finalement, l’image déconvoluée est la transformée de Fourier inverse de <span class="math notranslate nohighlight">\(GY\)</span> :</p>
<div class="math notranslate nohighlight">
\[
\widehat{x} = \mathcal{F}^{-1} \Bigg[\frac{H^* S_x}{|H|^2 S_x + S_b} Y \Bigg]
\]</div>
<p>On peut considérer que les densités spectrales de puissance <span class="math notranslate nohighlight">\(S_x\)</span> et <span class="math notranslate nohighlight">\(S_b\)</span> sont constantes
(pour <span class="math notranslate nohighlight">\(S_b\)</span>, il faut faire l’hypothèse d’un bruit blanc).
Ainsi, l’expression du filtre de Wiener peut s’écrire</p>
<div class="math notranslate nohighlight">
\[
\widehat{x} = \mathcal{F}^{-1} \Bigg[ \frac{H^*}{|H|^2 + S_b/S_x} Y \Bigg]
\]</div>
<p>et le terme <span class="math notranslate nohighlight">\(S_b/S_x\)</span> est remplacé par une constante <span class="math notranslate nohighlight">\(K\)</span>, qui devient le paramètre de la méthode, à régler par l’utilisateur.</p>
<p>Remarques :</p>
<ul>
<li><p>On note que lorsque <span class="math notranslate nohighlight">\(H\)</span> s’annule (typiquement dans les hautes fréquences),
on n’observe plus le problème d’augmentation du bruit comme avec le filtre inverse,
puisque le filtre inverse tend vers 0.</p></li>
<li><p>Par ailleurs, si le bruit dans l’image est nul, alors <span class="math notranslate nohighlight">\(S_b = 0\)</span> et on obtient le filtre inverse :</p>
<div class="math notranslate nohighlight">
\[
  \widehat{x}
  = \mathcal{F}^{-1} \Bigg[ \frac{H^*}{|H|^2} Y \Bigg]
  = \mathcal{F}^{-1} \Bigg[ \frac{Y}{H} \Bigg]
  \]</div>
</li>
</ul>
<p>Le résultat du filtre de Wiener est présenté <a class="reference internal" href="#f-deconvolution-wiener"><span class="std std-numref">Fig. 84</span></a> :
le résultat est clairement bien meilleur que le filtre de Wiener, même tronqué !</p>
<div class="figure align-default" id="f-deconvolution-wiener">
<a class="reference internal image-reference" href="_images/restauration14.png"><img alt="_images/restauration14.png" src="_images/restauration14.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-number">Fig. 84 </span><span class="caption-text">Résultat du filtre de Wiener, pour <span class="math notranslate nohighlight">\(K=10^{-5}\)</span>,
comparé au filtre inverse tronquée (10 % de la taille de l’image).</span><a class="headerlink" href="#f-deconvolution-wiener" title="Permalink to this image">¶</a></p>
</div>
<p>Cela dit, il n’est pas juste de comparer ces deux méthodes sur la <a class="reference internal" href="#f-deconvolution-wiener"><span class="std std-numref">Fig. 84</span></a>,
car les paramètres des méthodes (10% et <span class="math notranslate nohighlight">\(K=10^{-5}\)</span>) ne sont peut être pas les meilleurs.
Il se pose donc la question : comment régler le paramètre de chaque méthode ?</p>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<p>L’EQM dont il est question ici n’est pas au sens statistique, comme ci-avant.
Il s’agit ici du carré de la différence entre les deux images.</p>
</div>
<p>Pour y répondre, la <a class="reference internal" href="#f-deconvolution-parametre"><span class="std std-numref">Fig. 85</span></a> représente la qualité du résultat, en termes d’EQM,
en fonction de ces paramètres.
On constate que pour le meilleur choix des paramètres (point rouge sur la courbe),
l’EQM est bien meilleure pour le filtre de Wiener que pour le filtre inverse.
Le résultat correspondant est représenté <a class="reference internal" href="#f-deconvolution-wiener-best"><span class="std std-numref">Fig. 86</span></a>.
La différence sur cette sous-image est assez faible, mais il n’empêche que le dessin sur la voile est plus net avec le filtre de Wiener.</p>
<div class="figure align-default" id="f-deconvolution-parametre">
<a class="reference internal image-reference" href="_images/restauration15.png"><img alt="_images/restauration15.png" src="_images/restauration15.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-number">Fig. 85 </span><span class="caption-text">Comparaison de l’EQM en fonction du paramètre de la méthode, pour le filtre inverse tronqué et le filtre de Wiener.</span><a class="headerlink" href="#f-deconvolution-parametre" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="f-deconvolution-wiener-best">
<a class="reference internal image-reference" href="_images/restauration16.png"><img alt="_images/restauration16.png" src="_images/restauration16.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-number">Fig. 86 </span><span class="caption-text">Résultat du filtre inverse tronquée et du filtre de Wiener pour les meilleurs choix de paramètres.</span><a class="headerlink" href="#f-deconvolution-wiener-best" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>En résumé, la déconvolution consiste à inverser le filtrage (généralement passe-bas) qu’a subie l’image observée.
Le filtre inverse ne fonctionne pas car il tend à augmenter le bruit présent dans l’image.
Le filtre de Wiener reste donc la méthode de déconvolution la plus simple et qui donne un résultat acceptable.
De nombreuses autres méthodes ont été développées, comme la méthode de Richardson-Lucy [Richardson 1972, Lucy 1974] ou les méthodes bayésiennes.</p>
<!-- MAP Contrained least squares --></div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="denoising.html" title="previous page">Denoising</a>
    <a class='right-next' id="next-link" href="xxx_pattern.html" title="next page">(Pattern &amp; Co)</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Vincent Mazet (University of Strasbourg, France)<br/>
        
            &copy; Copyright 2020.<br/>
          <div class="extra_footer">
            Fundamental Tools for Image Processing &mdash; Vincent Mazet (Université de Strasbourg), 2020 &mdash; <a href="license.html">CC BY-NC 4.0</a>.
          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>