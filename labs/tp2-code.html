

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>14/10/2020 &#8212; Fundamental Tools for Image Processing</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jbvinc.css" />
    <link rel="stylesheet" type="text/css" href="../_static/.ipynb_checkpoints/jbvinc-checkpoint.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-dropdown.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="21/10/2020" href="tp3-code.html" />
    <link rel="prev" title="07/10/2020" href="tp1-code.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  
  <h1 class="site-logo" id="site-title">Fundamental Tools for Image Processing</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../preface.html">
   Preface
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Courses
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../definition.html">
   What is a Digital Image?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../operations.html">
   Arithmetic Operations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../histogram.html">
   Histogram
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../convolution.html">
   Convolution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../fourier.html">
   Fourier Transform
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../compression.html">
   Compression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../mm.html">
   Mathematical Morphology
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../interpolation.html">
   Interpolation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../registration.html">
   Registration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../segmentation.html">
   Segmentation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../deconvolution.html">
   Deconvolution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../denoising.html">
   Denoising
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xxx_pattern.html">
   (Pattern &amp; Co)
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  In-Class Sessions
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../tp1.html">
   07/10/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tp2.html">
   14/10/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tp3.html">
   21/10/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tp4.html">
   04/11/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tp5.html">
   18/11/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tp6.html">
   25/11/2020
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Corrections
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="tp1-code.html">
   07/10/2020
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   14/10/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tp3-code.html">
   21/10/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tp4-code.html">
   04/11/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tp5-code.html">
   18/10/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tp6-code.html">
   25/10/2020
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Appendices
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference external" href="https://moodle3.unistra.fr/course/view.php?id=13708">
   Moodle
   <i class="fas fa-external-link-alt">
   </i>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python.html">
   Installing and Using Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../glossary.html">
   Glossary
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../biblio.html">
   References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../license.html">
   License
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/labs/tp2-code.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/vincmazet/ftip/blob/master/labs/tp2-code.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#convolution">
   Convolution
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#objectives">
     Objectives
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#properties-of-the-fourier-transform">
   Properties of the Fourier transform
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     Objectives
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#magnitude-and-phase-of-the-fourier-transform">
   Magnitude and phase of the Fourier transform
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lossy-compression">
   Lossy compression
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     Objectives
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#images-de-base-de-la-dct">
     Images de base de la DCT
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#application-du-principe-jpeg-a-une-image">
     Application du principe JPEG à une image
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#evolution-du-psnr">
     Évolution du PSNR
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compression-d-image-avec-perte-imagettes-de-88">
     compression d’image avec perte (imagettes de 8×8)
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="id1">
<h1>14/10/2020<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="cell tag_hide docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">skimage</span> <span class="k">as</span> <span class="nn">ski</span>
<span class="kn">import</span> <span class="nn">skimage.io</span> <span class="k">as</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">skimage.filters</span> <span class="k">as</span> <span class="nn">filters</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="convolution">
<h2>Convolution<a class="headerlink" href="#convolution" title="Permalink to this headline">¶</a></h2>
<div class="section" id="objectives">
<h3>Objectives<a class="headerlink" href="#objectives" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>know how to use the function <code class="docutils literal notranslate"><span class="pre">scipy.ndimage.convolve</span></code> to apply the convolution product</p></li>
<li><p>be able to identify the kernel applied on a convolved image</p></li>
</ul>
<p>Before convolving the image by the different filters, it is interesting to display the filter itself.
In case we do not have the matrix representing this filter (like with the Gaussian filter <code class="docutils literal notranslate"><span class="pre">skimage.filters.gaussian</span></code>),
we can simply convolve the filter by an image containing only one non-zero pixel.
Indeed, this image is equivalent to a Dirac pulse <span class="math notranslate nohighlight">\(\delta\)</span> which is the neutral element of the convolution product.</p>
<p>The two last kernels are defined with:</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<p>and</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">))</span> <span class="o">/</span> <span class="n">N</span>
</pre></div>
</div>
</div>
</div>
<p>The results of the convolutions are shown below, for both the “Dirac pulse” and the smiley.</p>
<div class="cell tag_hide docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filtres à appliquer</span>

<span class="k">def</span> <span class="nf">identity</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span>

<span class="k">def</span> <span class="nf">gauss</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">filters</span><span class="o">.</span><span class="n">gaussian</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">diff</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">sp</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">mouv</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="n">N</span> <span class="o">=</span> <span class="mi">30</span> <span class="c1"># longueur du filtre</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">))</span> <span class="o">/</span> <span class="n">N</span>
    <span class="k">return</span> <span class="n">sp</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">duplicate</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">,]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">h</span><span class="p">[</span><span class="mi">9</span><span class="p">,]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">sp</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

<span class="c1"># Dictionnaire des convolutions</span>
<span class="n">convs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Image&quot;</span><span class="p">:</span> <span class="n">identity</span><span class="p">,</span>
    <span class="s2">&quot;Gaussian blur&quot;</span><span class="p">:</span> <span class="n">gauss</span><span class="p">,</span>
    <span class="s2">&quot;Gradient&quot;</span><span class="p">:</span> <span class="n">diff</span><span class="p">,</span>
    <span class="s2">&quot;Motion blur&quot;</span><span class="p">:</span> <span class="n">mouv</span><span class="p">,</span>
    <span class="c1">#&quot;Dédoublement&quot;: duplicate</span>
<span class="p">}</span>

<span class="n">K</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">convs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Images</span>

<span class="c1"># Dirac</span>
<span class="n">img1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
<span class="n">img1</span><span class="p">[</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Smiley</span>
<span class="n">img2</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;smiley.png&#39;</span><span class="p">)</span>
<span class="n">img2</span> <span class="o">=</span> <span class="n">ski</span><span class="o">.</span><span class="n">img_as_float</span><span class="p">(</span><span class="n">img2</span><span class="p">)</span>

<span class="c1"># Liste des images</span>
<span class="n">images</span> <span class="o">=</span> <span class="p">[</span><span class="n">img1</span><span class="p">,</span> <span class="n">img2</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convolutions</span>

<span class="c1"># Boucle sur les images</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>
    
    <span class="c1"># Nouvelle figure</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="c1"># Boucle sur les convolution</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="n">convs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">K</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">);</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/tp2-code_12_0.png" src="../_images/tp2-code_12_0.png" />
<img alt="../_images/tp2-code_12_1.png" src="../_images/tp2-code_12_1.png" />
</div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">skimage.filters.gaussian</span></code> defines a Gaussian kernel (this is the second image above).
he result of the function is the convolution product of this Gaussian kernel with the image given as a parameter of the function.</p>
<p>The “gradient” image brings out the vertical contours of the image.
We will reuse such a filter in the course on edge detection.</p>
</div>
</div>
<div class="section" id="properties-of-the-fourier-transform">
<h2>Properties of the Fourier transform<a class="headerlink" href="#properties-of-the-fourier-transform" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id2">
<h3>Objectives<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>manipulation of <code class="docutils literal notranslate"><span class="pre">fft2</span></code> et <code class="docutils literal notranslate"><span class="pre">fftshift</span></code></p></li>
<li><p>display adequately the magnitude of the Fourier transform to see the details</p></li>
<li><p>observe the effect of a contraction-dilation</p></li>
<li><p>observe the effect of a rotation</p></li>
<li><p>observe the effect of a translation</p></li>
</ul>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">skimage.io</span> <span class="k">as</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<p>Some remarks:</p>
<ul class="simple">
<li><p>After computing the Fourier transform with <code class="docutils literal notranslate"><span class="pre">numpy.fft.fft2</span></code>,
use the function <code class="docutils literal notranslate"><span class="pre">numpy.fft.fftshift</span></code> to shift the zero frequencies at the centre of the image.</p></li>
<li><p>The Fourier transform being complex, its display is not straightforward:
so one need to show its magnitude (<code class="docutils literal notranslate"><span class="pre">numpy.absolute</span></code>) and argument (<code class="docutils literal notranslate"><span class="pre">numpy.angle</span></code>).</p></li>
<li><p>The magnitude intensities are crushed by the intensity at the zero frequency, which is very large.
To get a readable display, one has to apply an histogram transform on the magnitude, for example with <code class="docutils literal notranslate"><span class="pre">numpy.log</span></code>.</p></li>
</ul>
<div class="cell tag_hide docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Supprime les warnings indiquant les log(0)</span>
<span class="c1"># import warnings</span>
<span class="c1"># warnings.filterwarnings(&#39;ignore&#39;)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    
    <span class="c1"># Chargement</span>
    <span class="n">img</span> <span class="o">=</span> <span class="s2">&quot;s</span><span class="si">%d</span><span class="s2">.png&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

    <span class="c1"># Transformée de Fourier</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft2</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
    
    <span class="c1"># Ramener les basses fréquences au centre de l&#39;image</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
    
    <span class="c1"># Affichage</span>
    <span class="c1"># Pensez à afficher le logarithme du module afin de voir quelque chose</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">F</span><span class="p">)),</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Magnitude (log)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">F</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Argument&quot;</span><span class="p">)</span>    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/vincent/anaconda3/lib/python3.7/site-packages/ipykernel_launcher.py:24: RuntimeWarning: divide by zero encountered in log
</pre></div>
</div>
<img alt="../_images/tp2-code_18_1.png" src="../_images/tp2-code_18_1.png" />
<img alt="../_images/tp2-code_18_2.png" src="../_images/tp2-code_18_2.png" />
<img alt="../_images/tp2-code_18_3.png" src="../_images/tp2-code_18_3.png" />
<img alt="../_images/tp2-code_18_4.png" src="../_images/tp2-code_18_4.png" />
<img alt="../_images/tp2-code_18_5.png" src="../_images/tp2-code_18_5.png" />
</div>
</div>
<p>This exercise highlights some properties of the Fourier transform.</p>
<ul class="simple">
<li><p>The images <code class="docutils literal notranslate"><span class="pre">s1</span></code> and<code class="docutils literal notranslate"> <span class="pre">s2</span></code> show that a “contraction” in the spatial domain
(the bands from <code class="docutils literal notranslate"><span class="pre">s1</span></code> to<code class="docutils literal notranslate"> <span class="pre">s2</span></code> get closer and narrower) results in “dilation” in the frequency domain
(the points diverge, even if the pattern remains overall the same, whether on the magnitude and the argument).</p></li>
<li><p>A rotation in the spatial domain results in an identical rotation in the frequency domain
(<code class="docutils literal notranslate"><span class="pre">s3</span></code> is a rotation of 90 ° of <code class="docutils literal notranslate"><span class="pre">s2</span></code>).</p></li>
<li><p>A spatial shift implies a modification on the argument (but not on the magnitude), hence the name of <em>phase shift</em>
(the white square of the images <code class="docutils literal notranslate"><span class="pre">s4</span></code> and<code class="docutils literal notranslate"> <span class="pre">s5</span></code> has been translated).</p></li>
</ul>
</div>
</div>
<div class="section" id="magnitude-and-phase-of-the-fourier-transform">
<h2>Magnitude and phase of the Fourier transform<a class="headerlink" href="#magnitude-and-phase-of-the-fourier-transform" title="Permalink to this headline">¶</a></h2>
<p>L’objectif de cet exercice est d’observer l’influence du module et de la phase sur la transformée de Fourier.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">skimage.io</span> <span class="k">as</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">skimage.color</span> <span class="k">as</span> <span class="nn">clr</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;lena.tiff&quot;</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">clr</span><span class="o">.</span><span class="n">rgb2gray</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft2</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">module</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
<span class="n">phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">60</span><span class="n">c787a9af7e</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">f</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;lena.tiff&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">f</span> <span class="o">=</span> <span class="n">clr</span><span class="o">.</span><span class="n">rgb2gray</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft2</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">module</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>

<span class="nn">~/anaconda3/lib/python3.7/site-packages/skimage/io/_io.py</span> in <span class="ni">imread</span><span class="nt">(fname, as_gray, plugin, **plugin_args)</span>
<span class="g g-Whitespace">     </span><span class="mi">46</span> 
<span class="g g-Whitespace">     </span><span class="mi">47</span>     <span class="k">with</span> <span class="n">file_or_url_context</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="k">as</span> <span class="n">fname</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">48</span>         <span class="n">img</span> <span class="o">=</span> <span class="n">call_plugin</span><span class="p">(</span><span class="s1">&#39;imread&#39;</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">plugin</span><span class="o">=</span><span class="n">plugin</span><span class="p">,</span> <span class="o">**</span><span class="n">plugin_args</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span> 
<span class="g g-Whitespace">     </span><span class="mi">50</span>     <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="s1">&#39;ndim&#39;</span><span class="p">):</span>

<span class="nn">~/anaconda3/lib/python3.7/site-packages/skimage/io/manage_plugins.py</span> in <span class="ni">call_plugin</span><span class="nt">(kind, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">208</span>                                <span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="n">kind</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">209</span> 
<span class="ne">--&gt; </span><span class="mi">210</span>     <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">211</span> 
<span class="g g-Whitespace">    </span><span class="mi">212</span> 

<span class="nn">~/anaconda3/lib/python3.7/site-packages/skimage/io/_plugins/tifffile_plugin.py</span> in <span class="ni">imread</span><span class="nt">(fname, dtype, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">46</span> 
<span class="g g-Whitespace">     </span><span class="mi">47</span>     <span class="c1"># read and return tiff as numpy array</span>
<span class="ne">---&gt; </span><span class="mi">48</span>     <span class="k">with</span> <span class="n">TiffFile</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_tiff</span><span class="p">)</span> <span class="k">as</span> <span class="n">tif</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span>         <span class="k">return</span> <span class="n">tif</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">~/anaconda3/lib/python3.7/site-packages/skimage/external/tifffile/tifffile.py</span> in <span class="ni">__init__</span><span class="nt">(self, arg, name, offset, size, multifile, multifile_close, pages, fastij, is_ome)</span>
<span class="g g-Whitespace">   </span><span class="mi">1328</span> 
<span class="g g-Whitespace">   </span><span class="mi">1329</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_fh</span> <span class="o">=</span> <span class="n">FileHandle</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span><span class="p">,</span>
<span class="ne">-&gt; </span><span class="mi">1330</span>                               <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1331</span>         <span class="bp">self</span><span class="o">.</span><span class="n">offset_size</span> <span class="o">=</span> <span class="kc">None</span>
<span class="g g-Whitespace">   </span><span class="mi">1332</span>         <span class="bp">self</span><span class="o">.</span><span class="n">pages</span> <span class="o">=</span> <span class="p">[]</span>

<span class="nn">~/anaconda3/lib/python3.7/site-packages/skimage/external/tifffile/tifffile.py</span> in <span class="ni">__init__</span><span class="nt">(self, file, mode, name, offset, size)</span>
<span class="g g-Whitespace">   </span><span class="mi">3517</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_close</span> <span class="o">=</span> <span class="kc">True</span>
<span class="g g-Whitespace">   </span><span class="mi">3518</span>         <span class="bp">self</span><span class="o">.</span><span class="n">is_file</span> <span class="o">=</span> <span class="kc">False</span>
<span class="ne">-&gt; </span><span class="mi">3519</span>         <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">3520</span> 
<span class="g g-Whitespace">   </span><span class="mi">3521</span>     <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">~/anaconda3/lib/python3.7/site-packages/skimage/external/tifffile/tifffile.py</span> in <span class="ni">open</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">3528</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3529</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">3530</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_fh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3531</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_close</span> <span class="o">=</span> <span class="kc">True</span>
<span class="g g-Whitespace">   </span><span class="mi">3532</span>             <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;/home/vincent/Ecole/FTIP/book/labs/lena.tiff&#39;
</pre></div>
</div>
</div>
</div>
<p>La transformée de Fourier étant complexe, elle peut s’écrire <span class="math notranslate nohighlight">\(\rho e^{j\theta}\)</span>. Il est donc possible de construire une image particulière en choisissant une valeur spécifique pour <span class="math notranslate nohighlight">\(\rho\)</span> ou pour <span class="math notranslate nohighlight">\(\theta\)</span>.</p>
<p>On choisira donc :</p>
<ul class="simple">
<li><p>pour la première image, <span class="math notranslate nohighlight">\(\rho\)</span> et <span class="math notranslate nohighlight">\(\theta\)</span> sont les module et phase de la transformée de Fourier de Lena,</p></li>
<li><p>pour la deuxième image, <span class="math notranslate nohighlight">\(\rho\)</span> est fixé à 1 et <span class="math notranslate nohighlight">\(\theta\)</span> est la phase de la transformée de Fourier de Lena,</p></li>
<li><p>pour la troisième image, <span class="math notranslate nohighlight">\(\rho\)</span> est le module de la transformée de Fourier de Lena et <span class="math notranslate nohighlight">\(\theta\)</span> est égal à 1.</p></li>
</ul>
<div class="cell tag_hide docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># hide</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="c1"># Fonction pour calculer une image dont la transformée de Fourier est le mélange</span>
<span class="c1"># d&#39;un module (m) et d&#39;une phase (p) donnés en arguments</span>
<span class="k">def</span> <span class="nf">melange</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span> <span class="n">m</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">p</span><span class="p">))</span>  <span class="c1"># TFD de l&#39;image g</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft2</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>                <span class="c1"># TFD inverse</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>                  <span class="c1"># Ne retourne que la partie réelle</span>
    
<span class="c1"># Vrais module et phase</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">melange</span><span class="p">(</span><span class="n">module</span><span class="p">,</span><span class="n">phase</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Module et phase originaux&#39;</span><span class="p">)</span>

<span class="c1"># Module constant</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">melange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">phase</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Module constant&#39;</span><span class="p">)</span>

<span class="c1"># Phase constante</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">melange</span><span class="p">(</span> <span class="n">module</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Phase constante&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>Observations &amp; conclusions :</p>
<ul class="simple">
<li><p>Heureusement, la reconstruction avec les véritables modules et phase est égale à l’image originale. Ce n’est pas le cas lorsque le module et la phase sont modifiés.</p></li>
<li><p>Lorsque seule la phase est conservée (module constant), les bords de l’image sont conservés,
mais pas les zones plus ou moins constantes de l’image sont mal reconstruites.
L’œil est pourtant capable de reconnaître l’image originale.</p></li>
<li><p>Lorsqu’au contraire seul le module est conservé pour la reconstruction, l’image est méconnaissable.
Elle paraît toute noire, mais ce n’est pas le cas !
Vérifiez : La plupart des pixels de cette image ne sont pas nuls.
(Comment peut-on faire pour observer les autres pixels ?).</p></li>
</ul>
<p>Cet exemple montre l’importance de la phase dans la perception de l’image. Vous pouvez aller plus loin en effectuant une reconstruction à partir du module d’une première image et de la phase d’une autre image !</p>
</div>
<div class="section" id="lossy-compression">
<h2>Lossy compression<a class="headerlink" href="#lossy-compression" title="Permalink to this headline">¶</a></h2>
<div class="cell tag_hide docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import warnings</span>
<span class="c1"># warnings.filterwarnings(&quot;ignore&quot;)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id3">
<h3>Objectives<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>savoir mettre en oeuvre le principe de base de la compression JPEG</p></li>
<li><p>utiliser la transformée en cosinus discrète</p></li>
<li><p>analyser l’effet de la compression sur la qualité visuelle et le PSNR</p></li>
</ul>
</div>
<div class="section" id="images-de-base-de-la-dct">
<h3>Images de base de la DCT<a class="headerlink" href="#images-de-base-de-la-dct" title="Permalink to this headline">¶</a></h3>
<p>Avant de commencer, il est intéressant d’afficher les images de base de la DCT.</p>
<p>Puisque les images de la base correspondent à un unique coefficient non nul dans le domaine de la transformée, une solution pour afficher ces images est de créer des images nulles dans le domaine de la transformée, sauf en un seul pixel. La fonction <code class="docutils literal notranslate"><span class="pre">scipy.fftpack.idctn</span></code> permet alors de représenter le cosinus 2D correspondant. Les basses fréquences se situent en haut à gauche.</p>
<p>Voici quelques exemples d’images de la base (sur la première ligne) et de leur DCT (sur la seconde ligne) pour une taille de 8×8 pixels.</p>
<p>On constate bien que les pixels en haut à gauche de la DCT (proches de l’origine, donc) correspondent à une fréquence basse puisqu’ils se traduisent par un cosinus bidimensionnel de basse fréquence dans le domaine spatial. À l’inverse, le pixel en bas à droite est la composante très haute fréquence : l’intensité des pixels évolue très vite dans l’image.</p>
</div>
<div class="section" id="application-du-principe-jpeg-a-une-image">
<h3>Application du principe JPEG à une image<a class="headerlink" href="#application-du-principe-jpeg-a-une-image" title="Permalink to this headline">¶</a></h3>
<p>Pour simplifier, la compression JPEG est appliquée sur une image carrée à niveau de gris.</p>
<p>Contrairement à la transformée de Fourier qui décompose une image sur une base d’exponentielles complexes, la DCT décompose une image sur une base de cosinus réels : le résultat est donc bien réel et il est inutile de distinguer module et phase lors de l’affichage. En revanche, le coefficient de fréquence nulle étant beaucoup plus grand que les autres, le contraste de la DCT est à modifier (comment ?) pour pouvoir la visualiser.</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="s2">&quot;lena.tiff&quot;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">rgb2gray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">dctn</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;ortho&#39;</span><span class="p">)</span>

<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">imshow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Lena&#39;</span><span class="p">)</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">imshow</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">absolute</span><span class="p">(</span><span class="n">X</span><span class="p">)),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;DCT de Lena</span><span class="se">\n</span><span class="s1">(en valeur absolue et contraste réhaussé)&#39;</span><span class="p">);</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>On peut remarquer (même si ça ne saute pas aux yeux) que les coefficients de fréquence faible sont plus énergétiques que les autres. Cela signifie que l’image est plutôt composée de basses fréquences.</p>
<p>Pour effectuer la compression, on choisit ici d’annuler les pixels haute fréquence à l’aide d’un masque carré de côté <span class="math notranslate nohighlight">\(C\)</span>. La taille du carré relativement à celle de l’image correspond au taux de compression.</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Taille (en pixels) du carré utilisé pour le masque</span>
<span class="n">C</span> <span class="o">=</span> <span class="mi">200</span>

<span class="c1"># Taille de l&#39;image originale</span>
<span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span>

<span class="c1"># Taux de compression</span>
<span class="n">taux</span> <span class="o">=</span> <span class="p">(</span><span class="n">C</span><span class="o">*</span><span class="n">C</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">M</span><span class="o">*</span><span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Copie de la DCT</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Masque</span>
<span class="n">Mask</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">Mask</span><span class="p">[:</span><span class="n">C</span><span class="p">,:</span><span class="n">C</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">Y</span><span class="o">*</span><span class="n">Mask</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">idctn</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;ortho&#39;</span><span class="p">)</span>

<span class="c1"># Affichage</span>
<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">imshow</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Lena (taux de compression : </span><span class="si">{:.0f}</span><span class="s1"> %)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">taux</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">imshow</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">absolute</span><span class="p">(</span><span class="n">Z</span><span class="p">)),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;DCT de Lena (compressée)&#39;</span><span class="p">);</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Avec pourtant un taux de compression très élevé, le résultat visuel est très bon : il est très difficile d’observer des différences entre les deux images. Cette observation est d’ailleurs confirmée par la valeur élevée du PSNR :</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Delta</span> <span class="o">=</span> <span class="mi">255</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">z</span> <span class="o">-</span> <span class="n">x</span>
<span class="n">Pb</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">M</span><span class="o">*</span><span class="n">N</span><span class="p">)</span>
<span class="n">PSNR</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">log10</span><span class="p">(</span><span class="n">Delta</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">Pb</span><span class="p">)</span>

<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">imshow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Originale&#39;</span><span class="p">)</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">imshow</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Compressée (PSNR = </span><span class="si">{:.2f}</span><span class="s1"> dB)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">PSNR</span><span class="p">))</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">imshow</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Différence&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>L’image de différence est intéressante, car on peut voir que les erreurs sont principalement situées dans les zones de l’image qui possèdent des hautes fréquences (contours, plumes du chapeau…). C’est logique puisque c’est justement ces hautes fréquences qui ont été annulées.</p>
<p>Le compression JPEG joue sur le fait que l’oeil humain n’est pas sensible à ces changements à haute fréquence.</p>
</div>
<div class="section" id="evolution-du-psnr">
<h3>Évolution du PSNR<a class="headerlink" href="#evolution-du-psnr" title="Permalink to this headline">¶</a></h3>
<p>La procédure précédente est utilisée pour différentes valeurs de <span class="math notranslate nohighlight">\(C\)</span>, afin de calculer le PSNR et l’EQM entre l’image compressée et l’image originale.</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Delta</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
<span class="n">taux</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
<span class="n">EQM</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">taux</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">PSNR</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">taux</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">Px</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">M</span><span class="o">*</span><span class="n">N</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">sqrt</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">taux</span><span class="p">):</span>
    
    <span class="n">C</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="n">M</span><span class="o">*</span><span class="n">N</span><span class="p">)</span>
    <span class="n">C</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    
    <span class="c1"># Compression</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">X</span><span class="p">;</span>
    <span class="n">Mask</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">Mask</span><span class="p">[:</span><span class="n">C</span><span class="p">,:</span><span class="n">C</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">Y</span><span class="o">*</span><span class="n">Mask</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">idctn</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;ortho&#39;</span><span class="p">)</span>
    
    <span class="c1"># Différence entre les deux images</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">z</span> <span class="o">-</span> <span class="n">x</span>
    
    <span class="c1"># EQM</span>
    <span class="n">EQM</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">M</span><span class="o">*</span><span class="n">N</span><span class="p">);</span>
    
    <span class="c1"># PSNR</span>
    <span class="n">PSNR</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">log10</span><span class="p">(</span><span class="n">Delta</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">EQM</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    
    <span class="c1"># Taux de compression</span>
<span class="c1">#     taux[i] = 1-count_nonzero(Mask)/(M*N)</span>

<span class="c1"># Affichage</span>
<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">taux</span><span class="p">,</span><span class="n">PSNR</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;taux&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;PSNR (dB)&#39;</span><span class="p">)</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">taux</span><span class="p">,</span><span class="n">EQM</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;taux&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;EQM&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>L’analyse des courbes permet d’aboutir aux conclusions suivantes.</p>
<ul class="simple">
<li><p>Plus le PSNR est grand, meilleure est la qualité de l’image :
il est donc logique qu’il augmente lorsque le taux de compression augmente.</p></li>
<li><p>À l’inverse, l’EQM mesure la différence entre l’image compressée et l’image originale :
lorsque le taux de compression augmente, la différence devient de plus en plus faible.</p></li>
<li><p>Pour des taux de compression très GRANDS, une petite variation du taux implique une variation rapide du PSNR :
il chute rapidement. Cela dit, leurs valeurs restent supérieures à 80 dB,
ce qui correspond tout de même à une très bonne qualité.</p></li>
</ul>
<p>Dans une compression classique JPEG, la DCT n’est pas directement calculée sur toute l’image, mais sur des imagettes de taille 8×8, comme cela est fait ci-après.</p>
</div>
<div class="section" id="compression-d-image-avec-perte-imagettes-de-88">
<h3>compression d’image avec perte (imagettes de 8×8)<a class="headerlink" href="#compression-d-image-avec-perte-imagettes-de-88" title="Permalink to this headline">¶</a></h3>
<p>L’image est découpée en blocs de 8×8 pixels, sur lesquels est calculée la DCT dont les hautes fréquences sont ensuite annulées. Le rayon du masque binaire doit donc être ajusté en conséquence. Pour mettre en évidence l’effet de bloc qui peut apparaître lorsque la compression est très forte, le rayon est petit par rapport à la taille des imagettes.</p>
<div class="cell tag_hide docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">C</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">B</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">dctn</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;ortho&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">M</span><span class="o">/</span><span class="n">B</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="n">B</span><span class="p">)):</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="n">m</span><span class="o">*</span><span class="n">B</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">B</span>
        <span class="n">n1</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="n">B</span>
        <span class="n">n2</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">B</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">m1</span><span class="p">:</span><span class="n">m2</span><span class="p">,</span><span class="n">n1</span><span class="p">:</span><span class="n">n2</span><span class="p">]</span>
        <span class="c1">###############################</span>
        <span class="c1">###############################</span>
        <span class="c1">###############################</span>
        <span class="c1">###############################</span>
        <span class="c1">###############################</span>
        <span class="c1"># [Hugo] Attention : ej en fais pas une copie ici !</span>
        <span class="c1"># Or la copie n&#39;est pas faite sans &quot;.copy()&quot; par exemple:</span>
        <span class="c1"># Y est juste une référence sur X. Mais c&#39;est sans conséquence dans le code car finalement Y n&#39;est pas modifée</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">dctn</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;ortho&#39;</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
        <span class="n">Mask</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">Mask</span><span class="p">[:</span><span class="n">C</span><span class="p">,:</span><span class="n">C</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">Y</span><span class="o">*</span><span class="n">Mask</span>
        <span class="n">z</span><span class="p">[</span><span class="n">m1</span><span class="p">:</span><span class="n">m2</span><span class="p">,</span><span class="n">n1</span><span class="p">:</span><span class="n">n2</span><span class="p">]</span> <span class="o">=</span> <span class="n">idctn</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;ortho&#39;</span><span class="p">)</span>

<span class="n">taux</span> <span class="o">=</span> <span class="p">(</span><span class="n">C</span><span class="o">*</span><span class="n">C</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">B</span><span class="o">*</span><span class="n">B</span><span class="p">)</span>

<span class="c1"># Affichage</span>
<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">imshow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Lena&#39;</span><span class="p">)</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">imshow</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Lena (compression : </span><span class="si">{:.2f}</span><span class="s1"> %)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">taux</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">imshow</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">240</span><span class="p">:</span><span class="mi">290</span><span class="p">,</span><span class="mi">240</span><span class="p">:</span><span class="mi">290</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">imshow</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="mi">240</span><span class="p">:</span><span class="mi">290</span><span class="p">,</span><span class="mi">240</span><span class="p">:</span><span class="mi">290</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./labs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="tp1-code.html" title="previous page">07/10/2020</a>
    <a class='right-next' id="next-link" href="tp3-code.html" title="next page">21/10/2020</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Vincent Mazet (University of Strasbourg, France)<br/>
        
            &copy; Copyright 2020.<br/>
          <div class="extra_footer">
            Fundamental Tools for Image Processing &mdash; Vincent Mazet (Université de Strasbourg), 2020 &mdash; <a href="license.html">CC BY-NC 4.0</a>.
          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
  </body>
</html>