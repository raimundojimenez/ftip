
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>21/10/2020 &#8212; Fundamental Tools for Image Processing</title>
    
  <link rel="stylesheet" href="../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/sphinx-book-theme.2d2078699c18a0efb88233928e1cf6ed.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jbvinc.css" />
    <link rel="stylesheet" type="text/css" href="../_static/.ipynb_checkpoints/jbvinc-checkpoint.css" />
    <link rel="stylesheet" type="text/css" href="../_static/spanels-index--0afa1ebdab0bb23b98b56d34c23d9f57.css" />
    <link rel="stylesheet" type="text/css" href="../_static/spanels-variables--ffc7f74dcb1b9eecba2dbcbc22818714.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.be0a4a0c39cd630af62a2fcf693f3f06.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="04/11/2020" href="tp4-code.html" />
    <link rel="prev" title="14/10/2020" href="tp2-code.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  
  <h1 class="site-logo" id="site-title">Fundamental Tools for Image Processing</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../preface.html">
   Preface
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Basics
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../definition.html">
   What is a Digital Image?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../operations.html">
   Arithmetic Operations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../histogram.html">
   Histogram
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../convolution.html">
   Convolution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../fourier.html">
   Fourier Transform
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Compression
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../compression.html">
   Compression
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Mathematical Morphology
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../mm.html">
   Mathematical Morphology
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Registration
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../interpolation.html">
   Interpolation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../registration.html">
   Registration
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Segmentation
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../segmentation.html">
   Segmentation
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Restoration
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../denoising.html">
   Denoising
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../deconvolution.html">
   Deconvolution
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Feature Detection
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../feature/intro.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../feature/edges.html">
   Edges detection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../feature/corners.html">
   Corner detection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../feature/lines.html">
   Line detection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../feature/outro.html">
   Conclusion
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  In-Class Sessions
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../tp1.html">
   07/10/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tp2.html">
   14/10/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tp3.html">
   21/10/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tp4.html">
   04/11/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tp5.html">
   18/11/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tp6.html">
   25/11/2020
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Corrections
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="tp1-code.html">
   07/10/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tp2-code.html">
   14/10/2020
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   21/10/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tp4-code.html">
   04/11/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tp5-code.html">
   18/11/2020
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tp6-code.html">
   25/10/2020
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Appendices
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference external" href="https://moodle3.unistra.fr/course/view.php?id=13708">
   Moodle
   <i class="fas fa-external-link-alt">
   </i>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python.html">
   Installing and Using Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../glossary.html">
   Glossary
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../biblio.html">
   References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../license.html">
   License
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/labs/tp3-code.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/vincmazet/ftip/blob/master/labs/tp3-code.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mathematical-morphology-morphologie-mathematique">
   Mathematical morphology (morphologie mathématique)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#objectif">
     Objectif
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#etude-des-differents-operateurs">
     Étude des différents opérateurs
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#detection-des-piscines">
     Détection des piscines
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#critique-de-la-methode">
     Critique de la méthode
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#registration-recalage">
   Registration (recalage)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     Objectif
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="id1">
<h1>21/10/2020<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="mathematical-morphology-morphologie-mathematique">
<h2>Mathematical morphology (morphologie mathématique)<a class="headerlink" href="#mathematical-morphology-morphologie-mathematique" title="Permalink to this headline">¶</a></h2>
<div class="section" id="objectif">
<h3>Objectif<a class="headerlink" href="#objectif" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>appliquer et comparer les opérations de base (érosion, dilatation, ouverture, fermeture)</p></li>
<li><p>évaluer les influences des paramètres de ces opérations</p></li>
<li><p>utiliser les composantes connexes à bon escient</p></li>
</ul>
<div class="cell tag_remove-input docutils container">
</div>
<p>L’image moliets.png est une vue satellitaire d’une petite commune des Landes. C’est une image RVB de résolution 50 cm.</p>
<div class="cell tag_remove-input docutils container">
</div>
<p>Étant donné que les objets recherchés sont plutôt bleus, et qu’aucun autre objet de la scène n’est de cette couleur, il peut être intéressant de travailler uniquement sur la bande bleue des images (où les piscines apparaîtrons très lumineuses) plutôt que, par exemple, sur l’image à niveau de gris. Cela permet une première discrimination entre les piscines et le reste.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">blue</span> <span class="o">=</span> <span class="n">img</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/tp3-code_8_0.png" src="../_images/tp3-code_8_0.png" />
</div>
</div>
<p>Les opérateurs de morphologie mathématique vu en cours fonctionnent sur des images binaires. La bande bleue peut dont être binarisée en la seuillant, et le seuil peut peut être choisi en observant l’histogramme de la bande bleue. Or, il s’avère que pour cette image, l’histogramme ne nous aide pas car on ne distingue pas deux classes dinstinctes.</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/tp3-code_10_0.png" src="../_images/tp3-code_10_0.png" />
</div>
</div>
<p>Le seuil est donc réglé « à la main », en procédant par essais-erreurs de manière à obtenir un résultat satisfaisant . On choisit un seuil égal à 240.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">binarized</span> <span class="o">=</span> <span class="p">(</span><span class="n">blue</span> <span class="o">&gt;</span> <span class="mi">240</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/tp3-code_13_0.png" src="../_images/tp3-code_13_0.png" />
</div>
</div>
</div>
<div class="section" id="etude-des-differents-operateurs">
<h3>Étude des différents opérateurs<a class="headerlink" href="#etude-des-differents-operateurs" title="Permalink to this headline">¶</a></h3>
<p>Dans cette partie, les opérateurs de la morphologie mathématique seront appliqués à la portion encadrée de l’image, reproduite ci-dessous.</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/tp3-code_16_0.png" src="../_images/tp3-code_16_0.png" />
</div>
</div>
<p>Pour commencer, nous choisissons comme élément structurant un disque de rayon 4 pixels.</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/tp3-code_18_0.png" src="../_images/tp3-code_18_0.png" />
</div>
</div>
<p>Les quatre opérateurs de base appliqués sur l’image produisent les résultats ci-dessous.</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/tp3-code_20_0.png" src="../_images/tp3-code_20_0.png" />
</div>
</div>
<ul class="simple">
<li><p>Quel(s) opérateur(s) tend(ent) à boucher les trous des objets ?</p></li>
<li><p>Au contraire, quel(s) opérateur(s) tend(ent) à supprimer les petits objets ?</p></li>
<li><p>Quel(s) opérateur(s) conserve(nt) (à peu près) la forme des objets ?</p></li>
</ul>
<p>Même chose avec un disque de rayon 10 pixels :</p>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/tp3-code_24_0.png" src="../_images/tp3-code_24_0.png" />
</div>
</div>
<p>N’hésitez pas à tester d’autres éléments structurants pour observer leur influence.</p>
</div>
<div class="section" id="detection-des-piscines">
<h3>Détection des piscines<a class="headerlink" href="#detection-des-piscines" title="Permalink to this headline">¶</a></h3>
<p>Dans la suite, on travaille avec le résultat d’une fermeture avec comme élément structurant un disque de rayon 10 pixels.</p>
<p>La fonction <code class="docutils literal notranslate"><span class="pre">skimage.morphology.label</span></code> retourne une labellisation des différentes composantes connexes, et la fonction <code class="docutils literal notranslate"><span class="pre">skimage.measure.regionprops</span></code> permet de mesurer certaines propriétés des composantes connexes, comme leur surface ou leur position.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Élément structurant</span>
<span class="n">selem</span> <span class="o">=</span> <span class="n">disk</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Fermeture</span>
<span class="n">img_closing</span> <span class="o">=</span> <span class="n">binary_closing</span><span class="p">(</span><span class="n">binarized</span><span class="p">,</span> <span class="n">selem</span><span class="p">)</span>

<span class="c1"># Labellisation des composantes connexes</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">label</span><span class="p">(</span><span class="n">img_closing</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Mesure des propriétés des composantes connexes</span>
<span class="n">props</span> <span class="o">=</span> <span class="n">regionprops</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

<span class="c1"># Nombre de composantes connexes</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">props</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Nombre de composantes connexes, donc de piscines détectées : </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>

<span class="c1"># Quelques propriétés de la région 0</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;La région </span><span class="si">{}</span><span class="s1"> contient </span><span class="si">{}</span><span class="s1"> pixels et son centroïde a pour coordonnées </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">props</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">area</span><span class="p">,</span> <span class="n">props</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">centroid</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nombre de composantes connexes, donc de piscines détectées : 69
La région 0 contient 29 pixels et son centroïde a pour coordonnées (1.0344827586206897, 624.4137931034483).
</pre></div>
</div>
</div>
</div>
<p>Les centres des composantes connexes sont représentés dans l’image ci-dessous par les points rouges.</p>
<p>Bien sûr il n’y a pas autant de piscines dans l’image : une grande partie des composantes connexes sont en fait des petits groupes de pixels qui ne correspondent pas à des piscines.</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/tp3-code_30_0.png" src="../_images/tp3-code_30_0.png" />
</div>
</div>
<p>Une amélioration est de considérer uniquement les composantes connexes dont le nombre de pixels est supérieur à un certain seuil. Dans notre cas, nous avons choisi de considérer comme étant des piscines les composantes connexes dont l’aire est supérieure à 20 pixels.</p>
<p>Par ailleurs, comme un pixel représente une surface de 0,5 x 0,5 m<sup>2</sup>, on en déduit la surface moyenne des piscines détectées.</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nombre de piscines détectées : 36
Surface moyenne des piscines détectées : 40.89 m²
</pre></div>
</div>
<img alt="../_images/tp3-code_32_1.png" src="../_images/tp3-code_32_1.png" />
</div>
</div>
</div>
<div class="section" id="critique-de-la-methode">
<h3>Critique de la méthode<a class="headerlink" href="#critique-de-la-methode" title="Permalink to this headline">¶</a></h3>
<p>Bien entendu, la méthode développée ici est simple et peu robuste : les piscines ombragées ou cachées en partie par un arbre ne sont pas toujours détectées. À l’inverse, certains objets peuvent être considérés comme des piscines car ils sont très lumineux dans la bande bleue et de taille importante. Aussi, quelques améliorations sont listées ci-dessous (la liste n’est pas exhaustive !) :</p>
<ul class="simple">
<li><p>la méthode proposée ne se base que sur la couleur bleue. Elle pourrait également prendre en compte la géométrie des composantes connexes : les piscines sont des objets bleus, suffisamment gros, et de forme plutôt rectangulaire (la notion de <a class="reference external" href="http://scikit-image.org/docs/dev/auto_examples/segmentation/plot_label.html"><em>bounding box</em></a> peut alors être utile) ;</p></li>
<li><p>le choix du seuil est fixé et fonctionne bien sur cette image. Mais rien n’assure que la valeur choisie puisse s’appliquer sur une autre image : rien ne permet de dire que cette méthode est robuste à la résolution du capteur, à la luminosité lors de la prise de vue, au type de piscine, etc. ;</p></li>
<li><p>la binarisation de l’image pourrait prendre en compte, en plus de la luminosité des pixels, la classe dans laquelle se trouvent les pxels voisins. Ce principe est souvent modélisé à l’aide de champs de Markov.</p></li>
</ul>
</div>
</div>
<div class="section" id="registration-recalage">
<h2>Registration (recalage)<a class="headerlink" href="#registration-recalage" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id2">
<h3>Objectif<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>L’objectif de cet exercice est d’appréhender le problème du recalage par un premier exemple simple.</p>
<p>Les deux images à recaler sont :</p>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/tp3-code_38_0.png" src="../_images/tp3-code_38_0.png" />
</div>
</div>
<p>Pour recaler la source sur la référence, l’image doit subir une rotation et une translation : il s’agit donc d’une déformation rigide, appelée aussi euclidienne car elle préserve la distance euclidienne entre les pixels de l’image.
Cette déformation correspond à appliquer deux opérations :</p>
<ul class="simple">
<li><p>une rotation de l’image d’un angle <span class="math notranslate nohighlight">\(\theta\)</span> est d’abord appliquée, autour du pixel <span class="math notranslate nohighlight">\((0,0)\)</span> (le coin en haut à gauche de l’image),</p></li>
<li><p>une translation <span class="math notranslate nohighlight">\((x,y)\)</span> est ensuite effectuée, la translation s’effectuant suivant le nouveau repère de l’image (selon la rotation précédente).</p></li>
</ul>
<p>La déformation rigide est donc définie par trois paramètres : une translation <span class="math notranslate nohighlight">\((x,y)\)</span> et une rotation <span class="math notranslate nohighlight">\(\theta\)</span>.
La fonction <code class="docutils literal notranslate"><span class="pre">skimage.transform.EuclideanTransform</span></code> permet de définir une telle déformation.
L’image est transformée selon cette déformation avec la fonction <code class="docutils literal notranslate"><span class="pre">skimage.transform.warp</span></code> :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">transformation</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">EuclideanTransform</span><span class="p">(</span><span class="n">translation</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span> <span class="n">rotation</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">warp</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">transformation</span><span class="p">)</span>
</pre></div>
</div>
<p>Une transformation de rotation <span class="math notranslate nohighlight">\(\pi/3\)</span> et de translation <span class="math notranslate nohighlight">\((400,-100)\)</span> donne ainsi :</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/tp3-code_40_0.png" src="../_images/tp3-code_40_0.png" />
</div>
</div>
<p>On peut comparer visuellement la différence entre la référence et l’image déformée (attention : vérifiez que les images ont la même dynamique !)…</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/tp3-code_42_0.png" src="../_images/tp3-code_42_0.png" />
</div>
</div>
<p>…ou en calculant l’EQM entre ces deux images :</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>EQM = 2.537e-02
</pre></div>
</div>
</div>
</div>
<p>Sans autre valeur de comparaison, on ne peut pas dire, uniquement à partir de l’EQM, si le résultat est bon ou pas.
On voit cependant sur la différence entre les deux images que le recalage n’est pas encore très bon.</p>
<p>Il faut donc optimiser le critère de similarité (ici, l’EQM) en fonction des paramètres de la transformation (<span class="math notranslate nohighlight">\(x\)</span>, <span class="math notranslate nohighlight">\(y\)</span>, <span class="math notranslate nohighlight">\(\theta\)</span>).
Bien qu’il existe beaucoup de méthodes d’optimisation très efficaces, nous allons ici utiliser une méthode toute simple qui consiste à essayer toutes les valeurs de ces trois paramètres.
Pour chaque triplet <span class="math notranslate nohighlight">\((x,y,\theta)\)</span> il faudra donc appliquer la déformation et calculer l’EQM : si le nombre de combinaison est grand, le temps de calcul sera vite très long !</p>
<p>L’idée est donc de tester certains triplets <span class="math notranslate nohighlight">\((x,y,\theta)\)</span> autour de <span class="math notranslate nohighlight">\((400,-100,\pi/3)\)</span> testé précédemment.
Par exemple, on choisit de tester les valeurs selons les intervalles :</p>
<div class="math notranslate nohighlight">
\[
x \in [300,500], \quad
y \in [-200,0], \quad
\theta \in [0,\pi].
\]</div>
<p>De plus, il faut commencer par un pas assez grossier, par exemple en allant de 10 en 10 pour les translations, et de <span class="math notranslate nohighlight">\(1\)</span> en <span class="math notranslate nohighlight">\(1\)</span> pour la rotation.
En fonction du résultat obtenu, on pourra ensuite affiner l’espace de recherche.</p>
<p>Le résultat obtenu de cette manière est le suivant :</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/tp3-code_46_0.png" src="../_images/tp3-code_46_0.png" />
<img alt="../_images/tp3-code_46_1.png" src="../_images/tp3-code_46_1.png" />
</div>
</div>
<p>L’EQM est plus faible que celle obtenue ci-avant, ce qui montre que le recalage est meilleur :</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>EQM = 4.144e-03
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./labs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="tp2-code.html" title="previous page">14/10/2020</a>
    <a class='right-next' id="next-link" href="tp4-code.html" title="next page">04/11/2020</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Vincent Mazet (University of Strasbourg, France)<br/>
        
            &copy; Copyright 2020.<br/>
          <div class="extra_footer">
            Fundamental Tools for Image Processing &mdash; Vincent Mazet (Université de Strasbourg), 2020 &mdash; <a href="license.html">CC BY-NC 4.0</a>.
          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>